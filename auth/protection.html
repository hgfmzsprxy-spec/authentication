<!DOCTYPE html>
<!-- This site was created in Webflow. https://webflow.com -->
<!-- Last Published: Fri Oct 03 2025 06:47:09 GMT+0000 (Coordinated Universal Time) -->
<html data-wf-domain="dash-template.webflow.io" data-wf-page="6059d479a501da25a83755f0" data-wf-site="6057ab51530cb39d3fdac75d" lang="en" class=" w-mod-js">
    <head>
        <meta charset="utf-8">
        <title>Protection - Varp Authentication</title>
        <meta content="Protection - Varp Authentication" property="og:title">
        <meta content="Protection - Varp Authentication" property="twitter:title">
        <meta content="width=device-width, initial-scale=1" name="viewport">
        <meta content="Webflow" name="generator">
    <link href="css/dash-template.webflow.shared.272232231.css" rel="stylesheet" type="text/css">
    <link href="css/dark-mode.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com" rel="preconnect">
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="js/webfont.js" type="text/javascript"></script>
    <script src="js/theme.js" type="text/javascript"></script>
        <script type="text/javascript">
            WebFont.load({
                google: {
                    families: ["Inter:regular,500,600,700"]
                }
            });
        </script>
        <script type="text/javascript">
            !function(o, c) {
                var n = c.documentElement
                  , t = " w-mod-";
                n.className += t + "js",
                ("ontouchstart"in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
            }(window, document);
        </script>
        <link href="images/608954b07e50af32f41306b7_Dash%20Favicon%20Small.png" rel="shortcut icon" type="image/x-icon">
        <link href="images/608954b52729362300b39dc9_Dash%20Logo.png" rel="apple-touch-icon">
        <style>
            .sidebar-profile-wrapper {
                margin-top: auto;
                padding: 16px 24px;
                border-top: 1px solid #e0e0e0;
            }
            .sidebar-profile-wrapper .banner-avatar-wrapper {
                display: flex;
                align-items: center;
                gap: 12px;
                text-decoration: none;
                color: inherit;
            }
            .sidebar-profile-wrapper .banner-avatar-image {
                width: 48px;
                height: 48px;
                border-radius: 50%;
                object-fit: cover;
            }
            .sidebar-profile-wrapper .banner-avatar-name {
                margin: 0;
                font-size: 0.95em;
                font-weight: 600;
                color: #333;
            }
            .sidebar-profile-wrapper .banner-avatar-caption {
                font-size: 0.85em;
                color: #666;
                margin-top: 2px;
            }
            /* Dropdown menu styling */
            .nav-dropdown {
                display: flex;
                flex-direction: column;
            }
            .nav-dropdown .nav-link {
                display: flex;
                align-items: center;
            }
            .nav-submenu {
                display: none;
                flex-direction: column;
            }
            .nav-submenu .nav-link {
                padding-left: 20px;
            }
            .dropdown-arrow {
                width: 20px;
                height: 20px;
                opacity: 0.7;
                transition: transform 0.3s ease;
                filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
            }
            .nav-link .dropdown-arrow {
                filter: brightness(0) saturate(100%) invert(40%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
            }
            .nav-link.w--current {
                color: var(--primary-blue);
            }
            .nav-link.w--current div {
                color: var(--primary-blue);
            }
            .nav-link.w--current .nav-icon {
                filter: brightness(0) saturate(100%) invert(28%) sepia(96%) saturate(6070%) hue-rotate(257deg) brightness(96%) contrast(104%);
            }
            /* Increase width of all elements */
            .dashboard-content {
                padding: 40px 50px !important;
            }
            .dashboard-container {
                max-width: 100% !important;
                width: 100% !important;
            }
            .main-grid {
                grid-column-gap: 30px !important;
                grid-row-gap: 30px !important;
            }
            .module {
                padding: 30px !important;
            }
            .table-module {
                padding: 30px !important;
            }
            ._4-grid {
                grid-column-gap: 30px !important;
                grid-row-gap: 30px !important;
            }
            /* Account table header styling */
            .account-table-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 24px 30px;
                border-bottom: 1px solid #e0e0e0;
            }
            .full-table-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 30px;
            }
            .full-table-row-divider {
                height: 1px;
                background-color: #e0e0e0;
                margin: 0;
            }
        </style>
    </head>
    <body>
        <div class="dashboard">
            <div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="dashboard-sidebar w-nav">
                <div class="sidebar-content">
                    <div class="sidebar-logo-wrapper">
                        <a href="/" class="w-nav-brand">
                            <img src="images/60586883ea59be120545c340_Dash%20Logo.svg" loading="lazy" alt="" class="sidebar-logo">
                        </a>
                    </div>
                    <a href="dashboard.html" class="nav-link w-inline-block">
                        <img src="images/icon-home.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Dashboard</div>
                    </a>
                    <a href="application.html" class="nav-link w-inline-block">
                        <img src="images/icon-laptop.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Application</div>
                    </a>
                    <a href="/" class="nav-link w-inline-block">
                        <img src="images/icon-key.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Licenses</div>
                    </a>
                    <div class="nav-dropdown">
                        <a href="#" class="nav-link w-inline-block w--current" onclick="toggleProtectionMenu(event)">
                            <img src="images/icon-shield.svg" loading="lazy" alt="" class="nav-icon">
                            <div>Protection</div>
                            <img src="images/60586d393a273570ab97cc78_chevron-down.svg" alt="" class="dropdown-arrow" style="margin-left: auto; transition: transform 0.3s;">
                        </a>
                        <div class="nav-submenu" id="protection-submenu" style="display: block; padding-left: 20px;">
                            <a href="protection.html" aria-current="page" class="nav-link w-inline-block w--current">
                                <img src="images/icon-file-text.svg" loading="lazy" alt="" class="nav-icon">
                                <div>Security Logs</div>
                            </a>
                            <a href="messages.html" class="nav-link w-inline-block">
                                <img src="images/icon-message-circle.svg" loading="lazy" alt="" class="nav-icon">
                                <div>Custom Messages</div>
                            </a>
                        </div>
                    </div>
                    <a href="/resellers" class="nav-link w-inline-block">
                        <img src="images/6058703e101182eaf273ae92_Team.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Resellers</div>
                    </a>
                    <div class="nav-divider"></div>
                    <a href="settings.html" class="nav-link w-inline-block">
                        <img src="images/icon-settings.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Settings</div>
                    </a>
                    <a href="admin.html" class="nav-link w-inline-block">
                        <img src="images/icon-admin.svg" loading="lazy" alt="" class="nav-icon">
                        <div>Administrator</div>
                    </a>
                    <!-- User Profile -->
                    <div class="sidebar-profile-wrapper">
                        <div class="banner-avatar-wrapper" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; cursor: pointer;" onclick="logout()">
                            <div id="user-avatar" class="banner-avatar-image" style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.2em;">U</div>
                            <div>
                                <h5 id="user-email" class="banner-avatar-name">Loading...</h5>
                                <div class="banner-avatar-caption">Click to logout</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-content">
                <div class="dashboard-container">
                    <div class="main-grid _4-grid">
                        <!-- Application Protection Card -->
                        <div class="table-module" style="grid-column: 1 / -1;">
                              <div class="account-table-header" style="flex-direction: column; align-items: flex-start;">
                                  <h4 class="no-space-bottom">Application Protection</h4>
                                  <div class="small-text text-grey-3" style="margin-top: 8px;">These settings are global and apply to all applications. Configure which information should be included in Discord webhook notifications.</div>
                              </div>
                            <div class="table-content">
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Application</h6>
                                        <div class="small-text text-grey-3">Include application name and version in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-application" name="protection-application" data-name="Protection Application" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-application"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Status</h6>
                                        <div class="small-text text-grey-3">Include authorization status in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-status" name="protection-status" data-name="Protection Status" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-status"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">PC Name</h6>
                                        <div class="small-text text-grey-3">Include PC name in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-pc-name" name="protection-pc-name" data-name="Protection PC Name" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-pc-name"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">HWID</h6>
                                        <div class="small-text text-grey-3">Include hardware ID in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-hwid" name="protection-hwid" data-name="Protection HWID" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-hwid"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">IPv4</h6>
                                        <div class="small-text text-grey-3">Include IPv4 address in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-ipv4" name="protection-ipv4" data-name="Protection IPv4" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-ipv4"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Expiration Date</h6>
                                        <div class="small-text text-grey-3">Include license expiration date in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-expiration-date" name="protection-expiration-date" data-name="Protection Expiration Date" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-expiration-date"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Last Login</h6>
                                        <div class="small-text text-grey-3">Include last login date in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-last-login" name="protection-last-login" data-name="Protection Last Login" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-last-login"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Reason</h6>
                                        <div class="small-text text-grey-3">Include failure reason in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-reason" name="protection-reason" data-name="Protection Reason" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-reason"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="full-table-row-divider"></div>
                                <div class="full-table-row">
                                    <div>
                                        <h6 class="no-space-bottom">Screenshot</h6>
                                        <div class="small-text text-grey-3">Include screenshot attachment in Discord webhook</div>
                                    </div>
                                    <div class="form-block w-form">
                                        <label class="w-checkbox switch-field">
                                            <div class="w-checkbox-input w-checkbox-input--inputType-custom switch-input w--redirected-checked"></div>
                                            <input type="checkbox" id="protection-screenshot" name="protection-screenshot" data-name="Protection Screenshot" style="opacity:0;position:absolute;z-index:-1" checked="">
                                            <span class="checkbox-label hidden w-form-label" for="protection-screenshot"></span>
                                        </label>
                                    </div>
                                </div>
                                <div style="padding: 24px 30px; border-top: 1px solid #e0e0e0; margin-top: 16px;">
                                    <button id="apply-settings-btn" class="button w-button" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1em; padding: 14px 24px; transition: transform 0.2s, box-shadow 0.2s;">
                                        Apply Settings
                                    </button>
                                    <div id="settings-message" style="margin-top: 12px; font-size: 0.9em; text-align: center;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/jquery-3.5.1.min.dc5e7f18c8.js" type="text/javascript" crossorigin="anonymous"></script>
        <script src="js/webflow.schunk.57d5559d2f0cd9f8.js" type="text/javascript"></script>
        <script src="js/webflow.schunk.fb41565a54c57ff6.js" type="text/javascript"></script>
        <script src="js/webflow.schunk.121b0d7ff03e0f4a.js" type="text/javascript"></script>
        <script src="js/webflow.33c9cbd5.185f4854ea36279a.js" type="text/javascript"></script>
        <script>
            // Handle checkbox clicks
            document.addEventListener('DOMContentLoaded', function() {
                const checkboxes = document.querySelectorAll('.switch-field input[type="checkbox"]');
                
                // Load global settings (for all applications)
                fetch('/api/protection/settings')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.settings) {
                            checkboxes.forEach(function(checkbox) {
                                let fieldName = checkbox.id.replace('protection-', '');
                                // Convert hyphens to underscores for matching
                                const fieldNameWithUnderscore = fieldName.replace(/-/g, '_');
                                if (data.settings.hasOwnProperty(fieldNameWithUnderscore)) {
                                    checkbox.checked = data.settings[fieldNameWithUnderscore];
                                }
                            });
                        }
                        
                        // Initialize checkbox states after loading
                        checkboxes.forEach(function(checkbox) {
                            const switchInput = checkbox.closest('.switch-field').querySelector('.switch-input');
                            if (checkbox.checked) {
                                switchInput.classList.add('w--redirected-checked');
                            } else {
                                switchInput.classList.remove('w--redirected-checked');
                            }
                            
                            // Handle click on label/switch
                            const label = checkbox.closest('.switch-field');
                            label.addEventListener('click', function(e) {
                                e.preventDefault();
                                checkbox.checked = !checkbox.checked;
                                
                                if (checkbox.checked) {
                                    switchInput.classList.add('w--redirected-checked');
                                } else {
                                    switchInput.classList.remove('w--redirected-checked');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Error loading settings:', error);
                        // Fallback: initialize checkboxes with default state
                        checkboxes.forEach(function(checkbox) {
                            const switchInput = checkbox.closest('.switch-field').querySelector('.switch-input');
                            if (checkbox.checked) {
                                switchInput.classList.add('w--redirected-checked');
                            } else {
                                switchInput.classList.remove('w--redirected-checked');
                            }
                            
                            const label = checkbox.closest('.switch-field');
                            label.addEventListener('click', function(e) {
                                e.preventDefault();
                                checkbox.checked = !checkbox.checked;
                                
                                if (checkbox.checked) {
                                    switchInput.classList.add('w--redirected-checked');
                                } else {
                                    switchInput.classList.remove('w--redirected-checked');
                                }
                            });
                        });
                    });
                
                // Load user info and permissions
                async function loadUserInfo() {
                    try {
                        const response = await fetch('/api/auth/me', {
                            credentials: 'include'
                        });
                        const data = await response.json();
                        
                        if (data.loggedIn && data.user) {
                            // Update profile in sidebar
                            const userEmailEl = document.getElementById('user-email');
                            const userAvatarEl = document.getElementById('user-avatar');
                            
                            if (userEmailEl) {
                                userEmailEl.textContent = data.user.display_name || data.user.email;
                            }
                            
                            if (userAvatarEl) {
                                if (data.user.avatar_url) {
                                    userAvatarEl.textContent = '';
                                    userAvatarEl.style.backgroundImage = `url(${data.user.avatar_url})`;
                                    userAvatarEl.style.backgroundSize = 'cover';
                                    userAvatarEl.style.backgroundPosition = 'center';
                                    userAvatarEl.style.backgroundRepeat = 'no-repeat';
                                } else {
                                    const firstLetter = (data.user.email || 'U').charAt(0).toUpperCase();
                                    userAvatarEl.textContent = firstLetter;
                                    userAvatarEl.style.backgroundImage = '';
                                    userAvatarEl.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                                }
                            }
                            
                            // Load permissions
                            await loadUserPermissions();
                        } else {
                            window.location.href = 'login.html';
                        }
                    } catch (error) {
                        console.error('Error loading user info:', error);
                        window.location.href = 'login.html';
                    }
                }
                
                // Load user permissions
                async function loadUserPermissions() {
                    try {
                        const response = await fetch('/api/auth/permissions', {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            console.error('Failed to load permissions');
                            return;
                        }
                        
                        const data = await response.json();
                        const userPermissions = data.permissions || {};
                        
                        // Check if user can edit security logs
                        if (userPermissions['security_logs']?.view && !userPermissions['security_logs']?.edit) {
                            // Add overlay to the card
                            const card = document.querySelector('.table-module');
                            if (card) {
                                lockElement(card, 'No Permissions, Lack of administrator Consent.');
                                card.querySelectorAll('input, select, button, textarea').forEach(disableElement);
                            }
                        }
                        // Also disable elements if no edit permission (even if no view)
                        if (!userPermissions['security_logs']?.edit) {
                            const checkboxes = document.querySelectorAll('#protection-settings-form input[type="checkbox"]');
                            checkboxes.forEach(cb => cb.disabled = true);
                            const applyBtn = document.getElementById('apply-settings-btn');
                            if (applyBtn) applyBtn.disabled = true;
                        }
                    } catch (error) {
                        console.error('Error loading permissions:', error);
                    }
                }
                
                // Logout function
                async function logout() {
                    if (!confirm('Are you sure you want to logout?')) {
                        return;
                    }
                    
                    try {
                        const response = await fetch('/api/auth/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });
                        
                        const data = await response.json();
                        
                        // Clear all cookies manually (fallback)
                        document.cookie.split(";").forEach(function(c) { 
                            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                        });
                        
                        // Clear sessionStorage and localStorage
                        sessionStorage.clear();
                        localStorage.clear();
                        
                        if (data.success) {
                            window.location.replace('login.html?' + Date.now());
                        } else {
                            window.location.replace('login.html?' + Date.now());
                        }
                    } catch (error) {
                        console.error('Error logging out:', error);
                        // Clear cookies and storage even on error
                        document.cookie.split(";").forEach(function(c) { 
                            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                        });
                        sessionStorage.clear();
                        localStorage.clear();
                        window.location.replace('login.html?' + Date.now());
                    }
                }
                
                // Helper function to lock element with overlay
                function lockElement(element, message) {
                    if (!element) return;
                    element.classList.add('permission-locked');
                    if (!element.querySelector('.permission-overlay')) {
                        const overlay = document.createElement('div');
                        overlay.className = 'permission-overlay';
                        overlay.innerHTML = `
                            <div class="lock-icon"></div>
                            <div>${message || 'No Permissions, Lack of administrator Consent.'}</div>
                        `;
                        element.appendChild(overlay);
                    }
                }
                
                function disableElement(element) {
                    if (!element) return;
                    element.classList.add('permission-disabled');
                    if (element.tagName === 'INPUT' || element.tagName === 'SELECT' || element.tagName === 'BUTTON' || element.tagName === 'TEXTAREA') {
                        element.setAttribute('disabled', 'disabled');
                    }
                    element.setAttribute('aria-disabled', 'true');
                    element.tabIndex = -1;
                }
                
                // Initialize
                loadUserInfo();
                
                // Handle Apply Settings button
                document.getElementById('apply-settings-btn').addEventListener('click', function() {
                    const settings = {};
                    checkboxes.forEach(function(checkbox) {
                        let fieldName = checkbox.id.replace('protection-', '');
                        // Convert hyphens to underscores (pc-name -> pc_name, expiration-date -> expiration_date, etc.)
                        fieldName = fieldName.replace(/-/g, '_');
                        settings[fieldName] = checkbox.checked;
                    });
                    
                    // Send to backend (global settings for all applications)
                    fetch('/api/protection/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            settings: settings
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.text().then(text => {
                                throw new Error(`HTTP error! status: ${response.status}, body: ${text}`);
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        const messageDiv = document.getElementById('settings-message');
                        if (data.success) {
                            messageDiv.textContent = 'Settings applied successfully!';
                            messageDiv.style.color = '#00c853';
                        } else {
                            messageDiv.textContent = data.error || 'Error applying settings';
                            messageDiv.style.color = '#f44336';
                        }
                        setTimeout(() => {
                            messageDiv.textContent = '';
                        }, 3000);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const messageDiv = document.getElementById('settings-message');
                        messageDiv.textContent = 'Error applying settings: ' + error.message;
                        messageDiv.style.color = '#f44336';
                        setTimeout(() => {
                            messageDiv.textContent = '';
                        }, 5000);
                    });
                });
            });
            
            function toggleProtectionMenu(event) {
                event.preventDefault();
                const submenu = document.getElementById('protection-submenu');
                const arrow = event.currentTarget.querySelector('.dropdown-arrow');
                if (submenu.style.display === 'none') {
                    submenu.style.display = 'block';
                    arrow.style.transform = 'rotate(180deg)';
                } else {
                    submenu.style.display = 'none';
                    arrow.style.transform = 'rotate(0deg)';
                }
            }
            
            // Universal navigation highlighting - run after all scripts load
            function highlightActiveNav() {
                const currentPath = window.location.pathname;
                
                // Remove w--current from all nav links
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('w--current');
                    link.removeAttribute('aria-current');
                });
                
                // Normalize current path (remove leading/trailing slashes, handle .html)
                const normalizePath = (path) => {
                    let normalized = path.replace(/^\/+|\/+$/g, ''); // Remove leading/trailing slashes
                    if (normalized === '' || normalized === 'index' || normalized === 'index.html') {
                        return '/';
                    }
                    normalized = normalized.replace(/\.html$/, ''); // Remove .html extension
                    return normalized;
                };
                
                const currentNormalized = normalizePath(currentPath);
                
                // Find active link by comparing href with current path
                let activeLink = null;
                document.querySelectorAll('.nav-link').forEach(link => {
                    const href = link.getAttribute('href');
                    if (!href) return;
                    
                    const hrefNormalized = normalizePath(href);
                    
                    // Special case for root/index
                    if (currentNormalized === '/' && (hrefNormalized === '/' || href === '/' || href === 'index.html' || href === '/index.html')) {
                        activeLink = link;
                    }
                    // Match other pages
                    else if (currentNormalized !== '/' && hrefNormalized === currentNormalized) {
                        activeLink = link;
                    }
                });
                
                // Add w--current to the active link
                if (activeLink) {
                    activeLink.classList.add('w--current');
                    activeLink.setAttribute('aria-current', 'page');
                }
                
                // Auto-expand protection submenu if on protection or messages page
                if (currentPath.includes('protection') || currentPath.includes('messages')) {
                    const submenu = document.getElementById('protection-submenu');
                    const arrow = document.querySelector('.nav-dropdown .dropdown-arrow');
                    if (submenu) {
                        submenu.style.display = 'block';
                        if (arrow) arrow.style.transform = 'rotate(180deg)';
                    }
                    
                    // Highlight the appropriate submenu link
                    if (currentPath.includes('protection')) {
                        const protectionLink = document.querySelector('a[href="protection.html"], a[href="/protection"]');
                        if (protectionLink) {
                            protectionLink.classList.add('w--current');
                            protectionLink.setAttribute('aria-current', 'page');
                        }
                    } else if (currentPath.includes('messages')) {
                        const messagesLink = document.querySelector('a[href="messages.html"], a[href="/messages"]');
                        if (messagesLink) {
                            messagesLink.classList.add('w--current');
                            messagesLink.setAttribute('aria-current', 'page');
                        }
                    }
                }
            }
            
            // Run on DOMContentLoaded and also on window load (after all scripts)
            document.addEventListener('DOMContentLoaded', highlightActiveNav);
            window.addEventListener('load', function() {
                // Small delay to ensure all scripts have finished
                setTimeout(highlightActiveNav, 100);
            });
        </script><script src="js/nav-permissions.js"></script></body>
</html>










